/**
 * Sharpen all bands of an image using IHS, where RGB bands are
 * converted to IHS and the intensity data is swapped for the
 * panchromatic band.
 * @param {ee.Image} img An image to sharpen.
 * @param {ee.Image} pan An single-band panchromatic image.
 * @return {ee.Image} The input image with all bands sharpened to the spatial 
 *  resolution of the panchromatic band.
*/
exports.sharpen = function (img, pan) {
    var p = img.select(pBand);
    var imgHsv = img.select([redBand, greenBand, blueBand]).rgbToHsv();

    // Replace the value band with the pan band and convert back to RGB
    var imgRgb = imgHsv
        .addBands([p])
        .select(["hue", "saturation", pBand])
        .hsvToRgb();

    return imgRgb;
}